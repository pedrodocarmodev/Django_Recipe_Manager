{% extends 'Base.html' %} {% block content %}

<div class="container mt-4">
  <div class="card shadow-sm">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h2 class="fw-bold mb-0">Adicionar Item</h2>
        <a href="{% url 'storage' %}" class="btn btn-outline-secondary">
          Voltar
        </a>
      </div>

      <form action="" method="POST">
        {% csrf_token %}

        <!-- Nome -->
        <div class="mb-3">
          <label class="form-label">Nome do Item</label>
          <input type="text" name="name" class="form-control" required />
        </div>

        <!-- Estoque (salvo no banco) -->
        <div class="mb-3">
          <label class="form-label">Estoque Atual (g ou ml)</label>
          <input
            type="number"
            step="0.01"
            min="0"
            name="quantity"
            class="form-control"
            required
          />
          <div class="form-text">
            Esta é a quantidade disponível no seu estoque.
          </div>
        </div>

        <hr />

        <h5 class="fw-semibold mt-4">Cálculo do Preço</h5>

        <!-- Valor Pago -->
        <div class="mb-3">
          <label class="form-label">Eu paguei (R$)</label>
          <input
            type="number"
            step="0.01"
            min="0"
            id="paid_price"
            class="form-control"
            required
          />
        </div>

        <!-- Quantidade comprada (apenas cálculo) -->
        <div class="mb-3">
          <label class="form-label">Por quantos g/ml?</label>
          <input
            type="number"
            step="0.01"
            min="0.01"
            id="purchase_quantity"
            class="form-control"
            required
          />
        </div>

        <!-- Preço por Kg -->
        <div class="mb-3">
          <label class="form-label">Preço por Kg/L (R$)</label>
          <input
            type="number"
            step="0.01"
            id="price_per_kg"
            name="price"
            class="form-control"
            readonly
            required
          />
          <div class="form-text">Este valor será salvo no banco.</div>
        </div>

        <button type="submit" class="btn btn-success">Salvar Item</button>
      </form>
    </div>
  </div>
</div>

<script>
  const paidPriceInput = document.getElementById("paid_price");
  const purchaseQuantityInput = document.getElementById("purchase_quantity");
  const pricePerKgInput = document.getElementById("price_per_kg");

  function calculatePricePerKg() {
    const paidPrice = parseFloat(paidPriceInput.value);
    const purchaseQuantity = parseFloat(purchaseQuantityInput.value);

    if (purchaseQuantity > 0 && paidPrice >= 0) {
      const pricePerKg = (paidPrice / purchaseQuantity) * 1000;
      pricePerKgInput.value = pricePerKg.toFixed(2);
    } else {
      pricePerKgInput.value = "";
    }
  }

  paidPriceInput.addEventListener("input", calculatePricePerKg);
  purchaseQuantityInput.addEventListener("input", calculatePricePerKg);
</script>

{% endblock %}
